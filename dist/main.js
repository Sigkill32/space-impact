(()=>{"use strict";const e={START_GAME:"END",STOP_GAME:"START"};function t(e,t,n){return function(s,o){e.beginPath(),e.rect(s,o,t,n),e.fillStyle="black",e.fill(),e.closePath()}}const n=function(e,n){const s=t(e,15,15),o=t(e,20,10);s(n.myShip.x,n.myShip.y);const i=Object.keys(n.enemyShips);i.length>0&&i.forEach((e=>{o(n.enemyShips[e].x,n.enemyShips[e].y)}));const a=Object.keys(n.bullets);a.length>0&&a.forEach((t=>{!function(e,t,n){e.beginPath(),e.rect(t,n,2,10),e.fillStyle="black",e.fill(),e.closePath()}(e,n.bullets[t].x,n.bullets[t].y)}))};function s(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}const o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),i=new Worker("BulletsWorks.js"),a=new Worker("EnemyWorker.js"),c=document.getElementById("gameCanvas"),l=document.querySelector(".SpaceImpact_GameToggle"),r=window.innerHeight,u=window.innerWidth;c.setAttribute("width",u-50),c.setAttribute("height",Math.floor(.8*r));const h=c.getContext("2d"),m=c.width,d=c.height,y=(new class{events={};subscribe=(e,t)=>{this.events[e]?this.events[e].push(t):this.events[e]=[t]};publish=(e,t)=>{this.events[e]&&this.events[e].forEach((e=>{e.call(this,t)}))}},{myShip:{x:Math.floor(m/2),y:d-30},enemyShips:{},bullets:{}});let g="STOP_GAME";function S(){h.clearRect(0,0,m,d),n(h,y)}function p(e){let{clientX:t}=e;o&&(t=e.changedTouches[0].clientX),y.myShip.x=t-25,S()}function f(e){let{type:t,clientX:n}=e;o&&(n=e.changedTouches[0].clientX),"mousedown"!==t&&"touchstart"!==t||(y.myShip.x=n-25,S(),c.addEventListener(o?"touchmove":"mousemove",p)),"mouseup"!==t&&"touchend"!==t||c.removeEventListener(o?"touchmove":"mousemove",p)}function E(e){y.bullets[e].y-=5,S(),y.bullets[e].y>=0?requestAnimationFrame((()=>E(e))):(delete y.bullets[e],S())}function b(){const e=s();y.bullets[e]={x:y.myShip.x+7.5,y:y.myShip.y},S(),E(e)}function v(e){y.enemyShips[e].y+=3,S(),y.enemyShips[e].y<=d?requestAnimationFrame((()=>v(e))):(delete y.enemyShips[e],S())}function A(){const e=s(),t=(0,n=m,Math.random()*(n-0)+0);var n;y.enemyShips[e]={x:t,y:0},S(),v(e)}n(h,y),c.addEventListener(o?"touchstart":"mousedown",f),c.addEventListener(o?"touchend":"mouseup",f),i.onmessage=function(e){const{data:t}=e,{message:n,data:s}=JSON.parse(t);switch(n){case"SHOOT_BULLET":b();break;case"END_GAME":console.log("game ended");break;default:return}},a.onmessage=function(e){const{data:t}=e,{message:n,data:s}=JSON.parse(t);switch(n){case"MOBILIZE_ENEMY":A();break;case"END_GAME":console.log("game ended");break;default:return}},l.addEventListener("click",(()=>{g="START_GAME"===g?"STOP_GAME":"START_GAME",i.postMessage(JSON.stringify({message:g,data:null})),a.postMessage(JSON.stringify({message:g,data:null})),l.textContent=e[g]}))})();